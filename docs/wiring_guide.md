# LD2412 雷達傳感器接線指南

## 硬體需求
- ESP8266-12F 開發板
- LD2412 雷達傳感器模組
- 杜邦線若干
- 麵包板（可選）

## 接線說明

### ESP8266-12F 引腳配置
```
ESP8266-12F    LD2412
-----------    ------
3.3V      ->   VCC (電源正極)
GND       ->   GND (電源負極)
GPIO15    ->   TX  (LD2412發送)
GPIO2     ->   RX  (LD2412接收)
GPIO13    ->   OUT (數位檢測輸出)
```

### 詳細接線圖
```
ESP8266-12F                    LD2412
    ┌─────────┐               ┌─────────┐
    │         │               │         │
    │    3.3V │──────────────→│   VCC   │
    │     GND │──────────────→│   GND   │
    │GPIO15   │──────────────→│    TX   │
    │GPIO2    │──────────────→│    RX   │
    │GPIO13   │──────────────→│   OUT   │
    │         │               │         │
    └─────────┘               └─────────┘
```

## 重要注意事項

### GPIO引腳說明
- **GPIO15**: 作為SoftwareSerial的RX，接收LD2412的TX數據
- **GPIO2**: 作為SoftwareSerial的TX（UART1-TXD），發送命令到LD2412的RX
- **GPIO13**: 作為數位輸入腳，讀取LD2412的OUT信號（人體檢測狀態）

### 電源要求
- LD2412 工作電壓：3.3V-5V
- 建議使用3.3V供電以匹配ESP8266
- 確保電源能提供足夠電流（約150mA）

### 串列通訊設定
- 波特率：256000 bps（預設）
- 數據位：8位
- 停止位：1位
- 校驗位：無

### GPIO引腳選擇原因
- **GPIO15**: 支援SoftwareSerial，啟動時為低電平，適合作為RX
- **GPIO2**: UART1的TXD腳，高速傳輸，適合作為TX
- **GPIO13**: 通用GPIO，無特殊功能衝突，適合作為數位輸入

### ⚠️ 重要警告
- **GPIO15**: 啟動時必須為LOW，確保LD2412的TX在啟動時不會輸出HIGH
- **GPIO2**: 啟動時必須為HIGH，一般情況下沒問題
- **GPIO0**: 避免使用，這是啟動模式選擇腳

## 測試步驟

### 1. 硬體連接檢查
- [ ] 確認所有接線正確
- [ ] 檢查電源電壓
- [ ] 確認沒有短路
- [ ] 特別檢查GPIO15在啟動時的狀態

### 2. 軟體設定
- [ ] 上傳測試程式到ESP8266
- [ ] 設定串列監視器波特率為115200
- [ ] 重啟ESP8266

### 3. 功能測試
- [ ] 觀察串列輸出是否正常
- [ ] 檢查OUT腳狀態變化
- [ ] 在傳感器前方移動測試檢測功能
- [ ] 比較串列數據和OUT腳狀態的一致性

## 故障排除

### 常見問題

1. **ESP8266無法啟動**
   - 檢查GPIO15是否正確接線
   - 確認LD2412的TX在啟動時不會干擾GPIO15
   - 可以在啟動時暫時斷開GPIO15連接

2. **無法檢測到目標**
   - 檢查接線是否正確
   - 確認電源供應穩定
   - 檢查LD2412是否正常工作
   - 確認OUT腳有正確連接

3. **串列通訊異常**
   - 確認波特率設定正確
   - 檢查TX/RX接線是否正確（注意不要交叉）
   - 確認GPIO引腳選擇正確

4. **OUT腳狀態異常**
   - 檢查GPIO13接線
   - 確認LD2412的OUT腳配置
   - 檢查是否有電氣干擾

### 調試技巧

1. **分步測試**
   ```cpp
   // 先測試OUT腳
   Serial.println(digitalRead(13));
   
   // 再測試串列通訊
   printRawData();
   ```

2. **檢查GPIO狀態**
   ```cpp
   // 在setup()中添加
   Serial.print("GPIO15 state: ");
   Serial.println(digitalRead(15));
   Serial.print("GPIO2 state: ");
   Serial.println(digitalRead(2));
   Serial.print("GPIO13 state: ");
   Serial.println(digitalRead(13));
   ```

3. **逐步測試**
   - 先測試基本通訊
   - 再測試OUT腳檢測
   - 最後測試完整功能

## 效能優化

### 降低功耗
- 調整檢測頻率
- 使用中斷方式讀取OUT腳
- 優化演算法

### 提高準確性
- 校準距離參數
- 調整敏感度閾值
- 比較串列數據和OUT腳狀態

### 增強穩定性
- 添加錯誤處理
- 實現自動重連
- 定期重置傳感器

## 進階功能

### 中斷檢測
```cpp
// 使用中斷檢測OUT腳變化
void IRAM_ATTR outPinISR() {
  // 中斷處理函數
}

void setup() {
  attachInterrupt(digitalPinToInterrupt(13), outPinISR, CHANGE);
}
```

### 雙重檢測
- 串列數據檢測：詳細的距離、能量信息
- OUT腳檢測：快速的數位狀態變化
- 交叉驗證：提高檢測準確性

### 擴展功能
- 添加OLED顯示屏
- 整合Wi-Fi連接
- 實現OTA更新
- 添加數據記錄

## 測試預期結果

### 正常工作狀態
```
=================================
    LD2412 雷達傳感器測試程序    
    硬體：ESP8266-12F + LD2412   
    串列：GPIO15(RX) GPIO2(TX)   
    OUT腳：GPIO13               
=================================

使用串列埠：GPIO15(RX) <-> LD2412 TX
            GPIO2(TX)  <-> LD2412 RX
使用OUT腳：GPIO13     <-> LD2412 OUT

[無目標] 移動 0cm:0 靜止 0cm:0 檢測 0cm OUT:LOW [一致]
>>> OUT腳檢測：目標出現 <<<
[目標+移動] 移動 150cm:45 靜止 0cm:0 檢測 150cm OUT:HIGH [一致] 